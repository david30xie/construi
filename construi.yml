image: ruby:1.9

environment:
  - CODECLIMATE_REPO_TOKEN
  - COVERALLS_TOKEN
  - RELEASE_COMMIT

targets:
  build:
    - bundle install --path=vendor/bundle
    - bundle exec rake spec

  install:
    - bundle install --path=vendor/bundle
    - bundle exec rake install

  release:
    - git config user.email levi.stephen@gmail.com
    - git config user.name lstephen
    - git checkout ${RELEASE_COMMIT}
    - git merge --no-ff --commit master
    - git push origin ${RELEASE_COMMIT}:master
    - bundle install --path vendor/bundle
    - bundle exec gem bump --version minor --push

  old_release:
    - git checkout master
    - git pull --rebase
    - git merge --no-ff --commit -m "Merge for release" develop
    - git push
    - git checkout develop
    - bundle install --path vendor/bundle
    - bundle exec gem bump --version minor --push

