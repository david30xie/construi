image: python:2.7

default: test

targets:
  version:
    image: lstephen/versiune:2
    run: -f python construi/__version__.py

  test: python setup.py test

  package:
    before:
      - version
    run:
      - rm -rf dist
      - python setup.py sdist

  release:
    before:
      - test
      - package
    environment:
      - DRY_RUN
      - TWINE_USERNAME
      - TWINE_PASSWORD
    volumes:
      - $GIT_SSH_KEY:/ssh/id_rsa
    run: scripts/release.sh

  flake8: python setup.py flake8

